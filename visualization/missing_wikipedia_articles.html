<!DOCTYPE html>
<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">
    <!-- <link rel="stylesheet" type="text/css" href="assets/style/style.css"> -->
    <link rel="icon" href="/assets/img/favicon-192.png" sizes="192x192">
</head>
<body>
    <h1>Curriculum Topics without Wikipedia Articles</h1>
    <div id="content"></div>

    <script>
        // Define the SPARQL queries for Uruguay and Ghana curriculum topics
        function getParams() {
            const urlParams = new URLSearchParams(window.location.search);
            return {country: urlParams.get('country'), langCode: urlParams.get('langCode'), language: urlParams.get('language')};
        }

        // Define the SPARQL query with a placeholder for the country code
        function buildQuery(countryCode, language) {
            return `
            SELECT DISTINCT ?qid ?mainSubject ?mainSubjectLabel
            WHERE {
            ?item wdt:P31 wd:Q600134.
            ?item wdt:P17 wd:${countryCode}.
            ?item wdt:P921 ?mainSubject.
            
            MINUS {
                ?article schema:about ?mainSubject;
                        schema:isPartOf <https://${language}.wikipedia.org/>.
            }

            SERVICE wikibase:label { bd:serviceParam wikibase:language "${language}". }
            }
            `
        }

        // Function to make SPARQL queries to Wikidata and populate the HTML view
        function fetchCurriculumTopics(query, language) {
            const options = {
      headers:new Headers({"Accept": "application/json",
        "Content-Type": "application/x-www-form-urlencoded",}),
      mode: 'cors'
    };
            fetch(`https://query.wikidata.org/sparql?query=${encodeURIComponent(query)}&format=json`, options)
                .then(response => {
                    console.log({res:response.data})
                    return response.json()})
                .then(data => {
                    console.log({data})
                    const contentDiv = document.getElementById('content');
                    const topics = data.results.bindings;
                    if (topics.length === 0) {
                        contentDiv.innerHTML += `<p>No topics found without articles in ${language} Wikipedia.</p>`;
                    } else {
                        contentDiv.innerHTML += `<h2>Topics without articles in ${language} Wikipedia:</h2>`;
                        contentDiv.style.padding = "20px"
                        const table = document.createElement('table');
                        table.classList = "table table-striped"
                        table.innerHTML += `<thead class='table-dark'> 
                            <tr>
                            <th scope="col">Main Subject</th>
                            <th scope="col">Link</th>
                            </tr>
                            <thead>`
                        
                        trow = document.createElement('tbody')
                        

                        topics.forEach(topic => {
                            const label = topic.mainSubjectLabel.value;
                            const itemUrl = `https://www.wikidata.org/wiki/${topic.mainSubject.value}`;
                            trow.innerHTML += `<tr>
                                <td>${label}</td>
                                <td><a href="${itemUrl}" target="_blank">${topic.mainSubject.value}</a></td>
                                </tr>
                                `;
                        });

                        table.appendChild(trow)
                        contentDiv.appendChild(table);
                    }
                })
                .catch(error => {
                    console.error(error);
                });
        }

        // Fetch and display Uruguay and Ghana curriculum topics
        const {country, langCode, language} = getParams()
        fetchCurriculumTopics(buildQuery(country, langCode), language);
    </script>
</body>
</html>
